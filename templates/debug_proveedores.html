{% extends "base.html" %}

{% block title %}Depuración de Proveedores{% endblock %}

{% block content %}
<div class="container">
    <h1>Depuración de Proveedores</h1>
    
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    Proveedores para ferreteria_general
                </div>
                <div class="card-body">
                    <button id="btnFG" class="btn btn-primary">Cargar Proveedores FG</button>
                    <div id="fg-proveedores" class="mt-3">
                        <ul class="list-group" id="fg-list"></ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    Proveedores para ricky
                </div>
                <div class="card-body">
                    <button id="btnRicky" class="btn btn-primary">Cargar Proveedores Ricky</button>
                    <div id="ricky-proveedores" class="mt-3">
                        <ul class="list-group" id="ricky-list"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('btnFG').addEventListener('click', function() {
        cargarProveedores('ferreteria_general', 'fg-list');
    });
    
    document.getElementById('btnRicky').addEventListener('click', function() {
        cargarProveedores('ricky', 'ricky-list');
    });
    
    function cargarProveedores(dueno, listId) {
        fetch(`/debug_obtener_proveedores_por_dueno/${dueno}`)
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById(listId);
                list.innerHTML = '';
                
                if (data.success && data.proveedores) {
                    data.proveedores.forEach(proveedor => {
                        const li = document.createElement('li');
                        li.className = 'list-group-item';
                        li.textContent = proveedor;
                        list.appendChild(li);
                    });
                    
                    const countLi = document.createElement('li');
                    countLi.className = 'list-group-item list-group-item-info';
                    countLi.textContent = `Total: ${data.proveedores.length} proveedores`;
                    list.appendChild(countLi);
                } else {
                    const li = document.createElement('li');
                    li.className = 'list-group-item list-group-item-danger';
                    li.textContent = data.error || 'Error desconocido';
                    list.appendChild(li);
                }
            })
            .catch(error => {
                const list = document.getElementById(listId);
                list.innerHTML = '';
                const li = document.createElement('li');
                li.className = 'list-group-item list-group-item-danger';
                li.textContent = 'Error de conexión: ' + error;
                list.appendChild(li);
            });
    }
});
</script>
{% endblock %}